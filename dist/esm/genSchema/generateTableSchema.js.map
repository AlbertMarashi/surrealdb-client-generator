{"version":3,"file":"generateTableSchema.js","sourceRoot":"","sources":["../../../src/genSchema/generateTableSchema.ts"],"names":[],"mappings":"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","sourcesContent":["import { createWriteStream, existsSync } from 'node:fs'\nimport { resolve } from 'node:path'\n\nimport { mkdirp } from 'mkdirp'\nimport { rimraf } from 'rimraf'\n\nimport { getAllTableNames } from '../database/getAllTableNames.js'\nimport { getTableFields } from '../database/getTableFields.js'\nimport { toCamelCase } from '../helper/toCamelCase.js'\nimport { toUpperCamelCase } from '../helper/toUpperCamelCase.js'\nimport { getSchemaStringFromDefinition } from './getSchemaStringFromDefinition.js'\n\nexport const generateTableSchema = async (outFolder: string) => {\n  const genSchemaFolder = resolve(outFolder, '_generated')\n  const tableNames = await getAllTableNames()\n\n  console.log('Generating schema in', genSchemaFolder)\n\n  for (const name of tableNames) {\n    const tableName = toCamelCase(name)\n\n    const tableSchemaFolder = resolve(genSchemaFolder, tableName)\n    console.log(`ðŸ‘‰ [${tableName}]: ${tableSchemaFolder}`)\n    await rimraf(tableSchemaFolder)\n    await mkdirp(tableSchemaFolder)\n\n    const fields = await getTableFields(tableName)\n\n    const genSchemaFileName = resolve(tableSchemaFolder, `${toCamelCase(tableName)}SchemaGen.ts`)\n    const genSchemaFile = createWriteStream(genSchemaFileName)\n\n    const inputFields = Object.entries(fields)\n      .map(([name, definition]) => {\n        return ` \"${name}\": ${getSchemaStringFromDefinition(definition, true)}`\n      })\n      .join(',\\n')\n\n    const outputFields = Object.entries(fields)\n      .map(([name, definition]) => {\n        return ` \"${name}\": ${getSchemaStringFromDefinition(definition, false)}`\n      })\n      .join(',\\n')\n\n    genSchemaFile.write(\n      `// ====================\n// DO NOT EDIT THIS FILE!\n// This file is autogenerated and will be overwritten during generation!\n// ====================\n\nimport { z } from \"zod\";\n\n// the create schema for table ${name}\nexport const ${tableName}InputSchemaGen = {\n${inputFields}\n};\n\n// the select schema for table ${name}\nexport const ${tableName}OutputSchemaGen = {\n${outputFields}\n};\n\n`,\n    )\n\n    genSchemaFile.close()\n    console.log(` âœ… [${tableName}]: ${tableName}Schema.ts`)\n\n    /*\n    const typesFileName = resolve(tableSchemaFolder,`${tableName}GenTypes.ts`)\n    const typesFile = createWriteStream(typesFileName)\n\n    typesFile.write(\n`// DO NOT EDIT THIS FILE!\n// This file is autogenerated and will be overwritten during generation!\n\nimport { z } from \"zod\";\n\nimport { ${tableName}InputSchemaGen, ${tableName}OutputSchemaGen } from \"./${tableName}SchemaGen.js\";\n\n// the create type for table ${name}\nexport type ${toUpperCamelCase(tableName)}InputGen = z.input<typeof ${tableName}InputSchemaGen>\n\n// the select type for table ${name}\nexport type ${toUpperCamelCase(tableName)}OutputGen = z.output<typeof ${tableName}OutputSchemaGen>\n`)\n\n    typesFile.close()\n    console.log(` âœ… [${tableName}]: ${tableName}GenTypes.ts`)\n*/\n\n    const schemaFolder = resolve(outFolder, 'schema', tableName)\n    await mkdirp(schemaFolder)\n\n    const schemaFileName = resolve(schemaFolder, `${toCamelCase(tableName)}Schema.ts`)\n\n    if (!existsSync(schemaFileName)) {\n      const sFile = createWriteStream(schemaFileName)\n      sFile.write(`/* Place your custom changes here */\n\nimport { z } from \"zod\";\n\nimport { ${tableName}InputSchemaGen, ${tableName}OutputSchemaGen } from \"../../_generated/${tableName}/${tableName}SchemaGen.js\";\n\n// payload schema for creating a new ${name} entity\nexport const ${tableName}CreateSchema = z.object({\n  ...${tableName}InputSchemaGen\n  // add your custom fields here, which are not part of SurrealDB table schema\n  // they are not overwritten by the next run\n})\n\n// payload schema for fetching a ${name} entity\nexport const ${tableName}Schema = z.object({\n  ...${tableName}OutputSchemaGen\n  // add your custom fields here, which are not part of SurrealDB table schema\n  // they are not overwritten by the next run\n})\n`)\n      sFile.close()\n    }\n\n    const typeFileName = resolve(schemaFolder, `${toCamelCase(tableName)}Types.ts`)\n\n    if (!existsSync(typeFileName)) {\n      const tFile = createWriteStream(typeFileName)\n      tFile.write(`/* Place your custom changes here */\n\nimport { z } from \"zod\";\n\nimport { ${tableName}CreateSchema, ${tableName}Schema } from \"./${tableName}Schema.js\";\n\n// the create type for table ${name}\nexport type Create${toUpperCamelCase(tableName)} = z.input<typeof ${tableName}CreateSchema>\n\n// the select type for table ${name}\nexport type ${toUpperCamelCase(tableName)} = z.output<typeof ${tableName}Schema>\n      `)\n      tFile.close()\n      console.log(` âœ… [${tableName}]: ${tableName}Types.ts`)\n    }\n  }\n}\n"]}